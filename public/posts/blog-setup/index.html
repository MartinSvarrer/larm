<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Hello, reader!</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/vs2015.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
  <header>
    <a href="/">Larm [lɑːˀm]</a>
  </header>

  <main>
    <article>
      <header>
        <h1>Hello, reader!</h1>
      </header>

      <p>As this is a tech blog, a hello world post seems appropriate. What better way to start than describing my approach to building my blog from scratch. I decided to not use an existing platform just for the fun of being able to learn some new things while building the blog itself.</p>
<p>Overall my initial goal is to publish this as a static blog on GitHub Pages, with an infrastructure that will help me write my first 10 blog posts.</p>
<h2>Writing experience</h2>
<p>I want my blog to be version controlled and saved in plain text. Markdown is a familiar format for me, and comes with all the features I think I need for writing my articles about development. Should I need more features I should be able to migrate from markdown to something else pretty easy, using something like <a href="https://pandoc.org/">pandoc</a>.</p>
<p>CommonMark markdown is to me the easiest choice, as it seems to be a common supported flavor by VS Code, Pandoc, and Github.</p>
<p>Next up I need to use an editor. My only requirement for now is spell-checking, and a minimal of visualization to know my markdown is correctly formatted. For this need Visual Studio Code with <a href="https://marketplace.visualstudio.com/items?itemName=ban.spellright">Spell Right</a> extension seems to do the trick.</p>
<h2>File structure (source and target)</h2>
<p>Each post may consist of:</p>
<ul>
<li>A markdown file</li>
<li>Assets related to the article</li>
<li>Article metadata</li>
</ul>
<p>To accommodate this let's create file structure:</p>
<ul>
<li><code>&lt;name-of-post&gt;</code>
<ul>
<li><code>&lt;name-of-post&gt;.md</code></li>
<li><code>assets/</code></li>
<li><code>metadata.json</code></li>
</ul>
</li>
</ul>
<p>Keeping the name of the post dynamic to match the parent folder, allows me to edit multiple articles and still see what I'm editing.</p>
<p>Each post should be published to provide nice URLs like <code>/&lt;name-of-post&gt;</code>.</p>
<p>Should eventually the build output should end up with:</p>
<ul>
<li><code>&lt;name-of-post&gt;/</code>
<ul>
<li><code>index.html</code></li>
<li><code>assets/</code></li>
</ul>
</li>
</ul>
<p>Which should make the post accessible at <code>/&lt;name-of-post&gt;</code>.</p>
<h2>Compile markdown to HTML</h2>
<p>For building a blog I will need to create a website with some static pages and somehow compile each blog post into a page which fits the overall design of the website. Each markdown file should be compiled to unique HTML pages.</p>
<p>VS code comes with a build-in preview mode. VS Code uses <a href="https://markdown-it.github.io/">markdown-it</a>, and I have decided to jump on board an use the same for automating the generation of my static web pages.</p>
<p>As this is a tech-blog I will also configure the <a href="https://highlightjs.org/">highlight.js</a> plugin for <code>markdown-it</code>, to support good code highlighting.</p>
<p>A naïve implementation for compiling the markdown will work for now. This version display the code used for compiling a all posts in <code>/posts</code> folder to the <code>public</code> folder. I don't have any <code>assets/</code> for this blog post nor do I have a <code>metadata.json</code> file, so will skip that part until it's needed.</p>
<p>The script for locating and compiling the markdown files look like the following:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> MarkdownIt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'markdown-it'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> hljs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlight.js'</span>);

<span class="hljs-keyword">const</span> md = <span class="hljs-keyword">new</span> MarkdownIt(<span class="hljs-string">'commonmark'</span>, {
  <span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str, lang</span>) </span>{
    <span class="hljs-keyword">if</span> (lang &amp;&amp; hljs.getLanguage(lang)) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> hljs.highlight(lang, str).value;
      } <span class="hljs-keyword">catch</span> (__) { }
    }
    <span class="hljs-comment">// use external default escaping</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  }
});
<span class="hljs-keyword">const</span> posts = fs.readdirSync(<span class="hljs-string">'posts/'</span>);

posts.forEach(<span class="hljs-keyword">async</span> (nameOfPost) =&gt; {
  <span class="hljs-keyword">const</span> pathToMdPost = path.resolve(<span class="hljs-string">'posts'</span>, nameOfPost, nameOfPost + <span class="hljs-string">'.md'</span>);
  <span class="hljs-keyword">const</span> markdownContent = <span class="hljs-keyword">await</span> fs.promises.readFile(pathToMdPost, { <span class="hljs-attr">encoding</span>: <span class="hljs-string">'utf8'</span> });
  <span class="hljs-keyword">const</span> postHtml = md.render(markdownContent);
  <span class="hljs-keyword">await</span> fs.promises.rmdir(<span class="hljs-string">'public/posts'</span>, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
  <span class="hljs-keyword">await</span> fs.promises.mkdir(<span class="hljs-string">`public/posts/<span class="hljs-subst">${nameOfPost}</span>`</span>, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
  <span class="hljs-keyword">await</span> fs.promises.writeFile(<span class="hljs-string">`public/posts/<span class="hljs-subst">${nameOfPost}</span>/index.html`</span>, postHtml);
});
</code></pre>
<h2>Templating</h2>
<p>The build output of each compiled markdown is an HTML fragment. To add design and a website layout elements like header, navigation and footer we must inline the content into a post layout template.</p>
<p>For this task, I have to choose between using an existing templating engine or use simple string replacements.</p>
<p>Lets begin with creating an HTML template, in which each blog post is added. I will use the syntax the style of <a href="http://mustache.github.io">mustache</a> like  <code>{{variable}}</code> to insert things into the template.</p>
<p>I imagine a template like the following for each post:</p>
<pre><code class="language-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>{{title}}<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>Larm [lɑːˀm]<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">article</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{{title}}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>

      {{content}}
    <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Doing a simple string replacement, works for me here, and no need for a template engine yet. I am sure using the templating engine is faster for me to get up and running and will serve me well, but where is the fun in that. Moving to a template engine later should be possible without too big changes.</p>
<p>Here is a snippet of replacing some variables in the template with appropriate content:</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> htmlContent = htmlTemplate
  .replace(<span class="hljs-regexp">/{{title}}/g</span>, metadata.title)
  .replace(<span class="hljs-regexp">/{{content}}/</span>, postHtml);
</code></pre>
<p>Simple, but effective!</p>
<h2>Styling</h2>
<p>We already configured the markdown so that we can display syntax highlighting. Adding the highlight.js stylesheets is now a simple and easy task:</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/vs2015.min.css"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>hljs.initHighlightingOnLoad();<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>

    </article>
  </main>
</body>

</html>